<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Operaciones - Transporte Anáhuac Mayab</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 */
        }
        .chart-container {
            position: relative;
            height: 40vh;
            width: 100%;
        }
        .file-upload-btn {
            background-color: #fff;
            border: 1px solid #e2e8f0;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 500;
            color: #334155;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        .file-upload-btn:hover {
            background-color: #f1f5f9;
            border-color: #cbd5e1;
        }
        #notification {
            transition: opacity 0.5s, transform 0.5s;
            transform: translateY(-20px);
        }
    </style>
</head>
<body class="text-slate-800">

    <!-- Notification Element -->
    <div id="notification" class="fixed top-5 right-5 bg-emerald-500 text-white py-3 px-5 rounded-lg shadow-lg opacity-0 z-50"></div>

    <!-- Header -->
    <header class="bg-white shadow-sm">
        <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
            <h1 class="text-3xl font-bold leading-tight text-slate-900">Dashboard de Operaciones de Transporte</h1>
            <p class="mt-1 text-sm text-slate-500">Análisis de Comportamiento de Alumnos | Periodo: Abril 2024</p>
        </div>
    </header>

    <main class="py-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

            <!-- Controles: Carga de Archivos y Filtros -->
            <section id="controles" class="mb-10 p-6 bg-white rounded-xl shadow">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Carga de Archivos -->
                    <div>
                        <h3 class="text-lg font-semibold text-slate-800 mb-3">Actualizar Datos</h3>
                        <div class="flex flex-wrap gap-4">
                            <input type="file" id="input-tickets" class="hidden" accept=".csv">
                            <button id="upload-tickets" class="file-upload-btn">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                                Archivo Tickets
                            </button>
                             
                            <input type="file" id="input-servicios" class="hidden" accept=".csv">
                            <button id="upload-servicios" class="file-upload-btn">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                                Archivo Servicios
                            </button>
                             
                            <input type="file" id="input-validaciones" class="hidden" accept=".csv">
                            <button id="upload-validaciones" class="file-upload-btn">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                                Archivo Validaciones
                            </button>
                        </div>
                    </div>
                    <!-- Filtros -->
                    <div>
                        <h3 class="text-lg font-semibold text-slate-800 mb-3">Filtrar por Fecha y Horario</h3>
                        <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                            <select id="filtro-ano" class="w-full rounded-md border-slate-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                                <option value="todos">Todos</option>
                                <option value="2024">2024</option>
                                <option value="2023">2023</option>
                            </select>
                            <select id="filtro-mes" class="w-full rounded-md border-slate-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                                <option value="todos">Todos</option>
                                <option value="4">Abril</option>
                                <option value="5">Mayo</option>
                                <option value="6">Junio</option>
                            </select>
                            <select id="filtro-dia" class="w-full rounded-md border-slate-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                                <option value="todos">Todos</option>
                                <!-- Días se podrían poblar dinámicamente -->
                            </select>
                            <select id="filtro-horario" class="w-full rounded-md border-slate-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                                <option value="todos">Todos</option>
                                <option value="manana">Mañana (6-12)</option>
                                <option value="tarde">Tarde (12-18)</option>
                                <option value="noche">Noche (18-23)</option>
                            </select>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- KPIs Principales -->
            <section id="kpis">
                <h2 class="text-xl font-semibold text-slate-700 mb-4">Indicadores Clave del Mes</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="bg-white rounded-xl shadow p-6"><p class="text-sm font-medium text-slate-500">Total de Viajes Realizados</p><p class="text-4xl font-bold text-blue-600" id="total-viajes">11,879</p><p class="text-xs text-slate-400 mt-2">Número total de validaciones en el mes.</p></div>
                    <div class="bg-white rounded-xl shadow p-6"><p class="text-sm font-medium text-slate-500">Pasajeros Únicos</p><p class="text-4xl font-bold text-indigo-600" id="pasajeros-unicos">946</p><p class="text-xs text-slate-400 mt-2">Estudiantes y colaboradores distintos.</p></div>
                    <div class="bg-white rounded-xl shadow p-6"><p class="text-sm font-medium text-slate-500">Ocupación Promedio</p><p class="text-4xl font-bold text-emerald-600" id="ocupacion-promedio">45.3%</p><p class="text-xs text-slate-400 mt-2">Eficiencia en el uso de la capacidad.</p></div>
                    <div class="bg-white rounded-xl shadow p-6"><p class="text-sm font-medium text-slate-500">Ruta Más Popular</p><p class="text-2xl font-bold text-amber-600" id="ruta-popular">Prolong. Montejo</p><p class="text-xs text-slate-400 mt-2">Con 3,116 viajes en el mes.</p></div>
                </div>
            </section>

            <!-- Gráficos de Análisis de Demanda -->
            <section id="analisis-demanda" class="mt-12">
                <h2 class="text-xl font-semibold text-slate-700 mb-4">Análisis de Demanda y Uso</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white rounded-xl shadow p-6"><h3 class="font-semibold text-slate-800">Viajes por Día del Mes</h3><p class="text-sm text-slate-500 mb-4">Patrones de uso semanales.</p><div class="chart-container"><canvas id="viajesPorDiaChart"></canvas></div></div>
                    <div class="bg-white rounded-xl shadow p-6"><h3 class="font-semibold text-slate-800">Horas de Mayor Afluencia</h3><p class="text-sm text-slate-500 mb-4">Identifica las horas pico.</p><div class="chart-container"><canvas id="viajesPorHoraChart"></canvas></div></div>
                </div>
            </section>

            <!-- Análisis de Rutas y Comportamiento de Compra -->
            <section id="rutas-y-compras" class="mt-12">
                 <div class="grid grid-cols-1 lg:grid-cols-5 gap-8">
                    <div class="bg-white rounded-xl shadow p-6 lg:col-span-3"><h3 class="font-semibold text-slate-800">Rendimiento de Rutas</h3><p class="text-sm text-slate-500 mb-4">Demanda y eficiencia por ruta.</p><div class="overflow-x-auto"><table class="min-w-full divide-y divide-slate-200"><thead class="bg-slate-50"><tr><th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Ruta</th><th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider"># Viajes</th><th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">% Ocupación</th></tr></thead><tbody class="bg-white divide-y divide-slate-200" id="top-rutas-table"></tbody></table></div></div>
                    <div class="bg-white rounded-xl shadow p-6 lg:col-span-2"><h3 class="font-semibold text-slate-800">Comportamiento de Compra</h3><p class="text-sm text-slate-500 mb-4">Preferencia por tipo de pase.</p><div class="chart-container h-[35vh]"><canvas id="tipoPaseChart"></canvas></div></div>
                </div>
            </section>

            <!-- Observaciones y Recomendaciones -->
            <section id="observaciones" class="mt-12">
                <div class="bg-white rounded-xl shadow p-8">
                    <h2 class="text-xl font-semibold text-slate-800 mb-4">Observaciones y Recomendaciones Estratégicas</h2>
                    <div class="space-y-6 text-slate-600">
                        <div>
                            <h3 class="text-lg font-semibold text-slate-700 mb-2">1. Optimización de Recursos y Eficiencia Operativa</h3>
                            <ul class="list-disc list-inside space-y-1">
                                <li><strong>Redimensionar Flota en Rutas de Baja Demanda:</strong> Rutas como "El Pocito" y "Norte" muestran una ocupación consistentemente baja (32-37%). Evaluar el uso de vehículos más pequeños en estos trayectos podría generar ahorros significativos en combustible y mantenimiento sin afectar la disponibilidad.</li>
                                <li><strong>Refuerzos Dinámicos en Horas Pico:</strong> La demanda se concentra masivamente a las 6-7 AM y 8-9 PM. Implementar "unidades de refuerzo" que operen solo en estas ventanas en las rutas de alta demanda (Prolong. Montejo, Calle 60) puede mejorar la experiencia del alumno y evitar la percepción de saturación.</li>
                            </ul>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-slate-700 mb-2">2. Entendimiento del Comportamiento de Compra</h3>
                            <ul class="list-disc list-inside space-y-1">
                                <li><strong>Fidelización del Usuario Recurrente:</strong> El "Pase Semanal" domina las ventas (casi 70% de los tickets). Esto indica una base de usuarios leal. Se recomienda lanzar un programa de lealtad (ej. "Compra 4 pases semanales y obtén un descuento en el 5to") para retener a este segmento.</li>
                                <li><strong>Potenciar al Usuario Ocasional:</strong> El "Pase Redondo" representa un 28% de los tickets. Para este grupo, se pueden crear promociones puntuales vía la app o correo electrónico (ej. "Viaja 3 veces esta semana y el 4to viaje redondo es a mitad de precio") para incentivar un mayor uso.</li>
                                <li><strong>Explorar Nuevos Productos:</strong> Considerar la viabilidad de un "Pase Mensual" con un ligero descuento. Esto simplificaría la compra para los usuarios más frecuentes, aseguraría un flujo de ingresos más predecible al inicio del mes y aumentaría la barrera de salida hacia otros medios de transporte.</li>
                            </ul>
                        </div>
                         <div>
                            <h3 class="text-lg font-semibold text-slate-700 mb-2">3. Estrategia y Crecimiento</h3>
                            <ul class="list-disc list-inside space-y-1">
                                <li><strong>Encuestas de Satisfacción Geo-localizadas:</strong> Utilizar la app para lanzar encuestas breves a los usuarios justo al terminar su viaje en rutas específicas. Esto puede proporcionar insights valiosos sobre la calidad del servicio, puntualidad y comodidad que los números brutos no muestran.</li>
                                <li><strong>Análisis de Demanda Insatisfecha:</strong> Cruzar los datos de horarios y rutas con los horarios de clases y actividades extracurriculares. Podríamos estar perdiendo pasajeros por no tener una salida a las 10:00 PM, por ejemplo. Analizar esta "demanda fantasma" puede abrir nuevas oportunidades de servicio.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

        </div>
    </main>

    <footer class="bg-white mt-12 border-t">
        <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 text-center text-sm text-slate-500">
            <p>&copy; 2024 Dirección de Operaciones - Universidad Anáhuac Mayab</p>
        </div>
    </footer>

    <script>
        // --- INICIO DE DATOS AGREGADOS ---
        const viajesPorDiaData = { labels: ["01", "02", "03", "04", "05", "06", "07", "08", "09", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "30"], values: [551, 608, 621, 620, 482, 10, 1, 574, 663, 624, 642, 513, 11, 0, 563, 638, 597, 631, 480, 10, 1, 570, 629, 584, 602, 473, 11, 0, 490, 510] };
        const viajesPorHoraData = { labels: ["06", "07", "08", "09", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22"], values: [2284, 1101, 384, 237, 241, 196, 429, 786, 1278, 831, 541, 497, 602, 731, 882, 609, 250] };
        const topRutasData = [ { ruta: "PROLONGACIÓN MONTEJO (LUN-VIE)", viajes: 3116, ocupacion: "53.5%" }, { ruta: "CALLE 60 (LUN-VIE)", viajes: 2751, ocupacion: "46.8%" }, { ruta: "ORIENTE (LUN-VIE)", viajes: 2058, ocupacion: "53.8%" }, { ruta: "NORTE (LUN-VIE)", viajes: 1121, ocupacion: "37.6%" }, { ruta: "EL POCITO (LUN-VIE)", viajes: 874, ocupacion: "32.8%" }, { ruta: "ALIANZA DE CAMIONEROS (LUN-VIE)", viajes: 738, ocupacion: "48.1%" } ];
        const tipoPaseData = { labels: ["Pase Semanal (10)", "Pases Redondos (2)", "Otros"], values: [12290, 5020, 321] };
        // --- FIN DE DATOS AGREGADOS ---

        document.addEventListener('DOMContentLoaded', () => {

            // --- LÓGICA DE CARGA DE ARCHIVOS ---
            const setupFileUpload = (buttonId, inputId, fileType) => {
                const button = document.getElementById(buttonId);
                const input = document.getElementById(inputId);

                button.addEventListener('click', () => input.click());
                input.addEventListener('change', (event) => {
                    const file = event.target.files[0];
                    if (file) {
                        console.log(`Archivo de ${fileType} seleccionado:`, file.name);
                        showNotification(`"${file.name}" cargado con éxito.`);
                        // En una aplicación real, aquí se llamaría a la función para procesar el CSV.
                        // e.g., processCSV(file, fileType);
                        input.value = ''; // Permite volver a cargar el mismo archivo
                    }
                });
            };
            
            setupFileUpload('upload-tickets', 'input-tickets', 'Tickets');
            setupFileUpload('upload-servicios', 'input-servicios', 'Servicios');
            setupFileUpload('upload-validaciones', 'input-validaciones', 'Validaciones');

            const showNotification = (message) => {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.style.transform = 'translateY(0)';
                notification.classList.remove('opacity-0');
                setTimeout(() => {
                    notification.style.transform = 'translateY(-20px)';
                    notification.classList.add('opacity-0');
                }, 4000); // La notificación se oculta después de 4 segundos
            };

            // --- LÓGICA DE FILTROS ---
            document.getElementById('filtro-ano').addEventListener('change', (e) => console.log(`Filtro Año cambiado a: ${e.target.value}`));
            document.getElementById('filtro-mes').addEventListener('change', (e) => console.log(`Filtro Mes cambiado a: ${e.target.value}`));
            document.getElementById('filtro-dia').addEventListener('change', (e) => console.log(`Filtro Día cambiado a: ${e.target.value}`));
            document.getElementById('filtro-horario').addEventListener('change', (e) => console.log(`Filtro Horario cambiado a: ${e.target.value}`));

            // --- LÓGICA DE GRÁFICOS ---
            const chartOptions = { maintainAspectRatio: false, responsive: true, scales: { y: { beginAtZero: true, grid: { color: '#e2e8f0' }, ticks: { color: '#64748b' } }, x: { grid: { display: false }, ticks: { color: '#64748b' } } }, plugins: { legend: { display: false } } };

            const ctxDia = document.getElementById('viajesPorDiaChart').getContext('2d');
            new Chart(ctxDia, { type: 'line', data: { labels: viajesPorDiaData.labels, datasets: [{ label: 'Número de Viajes', data: viajesPorDiaData.values, backgroundColor: 'rgba(59, 130, 246, 0.1)', borderColor: 'rgba(59, 130, 246, 1)', borderWidth: 2, fill: true, tension: 0.4 }] }, options: chartOptions });
            const ctxHora = document.getElementById('viajesPorHoraChart').getContext('2d');
            new Chart(ctxHora, { type: 'bar', data: { labels: viajesPorHoraData.labels.map(h => `${h}:00`), datasets: [{ label: 'Número de Viajes', data: viajesPorHoraData.values, backgroundColor: 'rgba(107, 33, 168, 0.8)', borderColor: 'rgba(107, 33, 168, 1)', borderWidth: 1 }] }, options: chartOptions });
            const ctxPase = document.getElementById('tipoPaseChart').getContext('2d');
            new Chart(ctxPase, { type: 'doughnut', data: { labels: tipoPaseData.labels, datasets: [{ label: 'Distribución de Tickets Vendidos', data: tipoPaseData.values, backgroundColor: ['rgba(2, 132, 199, 0.9)', 'rgba(219, 39, 119, 0.9)', 'rgba(245, 158, 11, 0.9)'], borderColor: '#ffffff', borderWidth: 3 }] }, options: { maintainAspectRatio: false, responsive: true, plugins: { legend: { position: 'bottom', labels: { color: '#64748b', padding: 20 } } } } });

            const rutasTableBody = document.getElementById('top-rutas-table');
            topRutasData.forEach(ruta => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap"><div class="text-sm font-medium text-slate-900">${ruta.ruta.replace(' (LUN-VIE)', '')}</div></td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">${ruta.viajes.toLocaleString('es-MX')}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm"><span class="font-semibold ${parseFloat(ruta.ocupacion) > 50 ? 'text-emerald-600' : 'text-amber-600'}">${ruta.ocupacion}</span></td>
                `;
                rutasTableBody.appendChild(tr);
            });
        });
    </script>
</body>
</html>

